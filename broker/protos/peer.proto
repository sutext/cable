syntax = "proto3";

option go_package = "./protos";

package protos;

/// An empty message.
message Empty{
}
/// Target represents a message target
message Target{
  string cid = 1;
  string net = 2;
}
/// IsOnlineReq is the request message for IsOnline RPC.
message IsOnlineReq{
  repeated Target targets = 1;
}
/// IsOnlineResp is the response message for IsOnline RPC.
message IsOnlineResp{
  bool online = 1;
}

/// MessageReq is the request message for SendToClients RPC.
message MessageReq{
  bytes message = 3;
  repeated Target targets = 4;
}

/// MessageResp is the response message for SendMessage RPC.
message MessageResp{
 int32 total = 1;
 int32 success = 2;
}

/// KickConnReq is the request message for KickUser RPC.
message KickConnReq{
  repeated Target targets = 1;
}

/// Inspects is the response message for Inspect RPC.
message Inspects{
 string id = 1;
 int32 user_count = 2;
 int32 client_count = 3;
 int32 cluster_size = 4;
 int32 channel_count = 5;
}
// UserOpenedReq is the request message for UserOpened RPC.
message UserOpenedReq {
  string uid = 1;
  string cid = 2;
  string net = 3;
  string peer_id = 4;
}
// UserClosedReq is the request message for UserClosed RPC.
message UserClosedReq {
  string uid = 1;
  string cid = 2;
}

// RaftMessage represents a Raft message
message RaftMessage {
  // Raft message data in binary format
  bytes data = 1;
}

// The greeting service definition.
service PeerService {
  // Inspect provides peer inspection info.
  // For example: user count, client count, cluster size, channel count.
  // It is mainly used for monitoring and debugging.
  rpc Inspect (Empty) returns (Inspects) {}
  // IsOnline checks if a user is online.
  rpc IsOnline (IsOnlineReq) returns (IsOnlineResp) {}
  // KickConn kicks a connection by connection ID.
  rpc KickConn (KickConnReq) returns (Empty) {}
  // SendMessage sends a message to a user or a channel.
  rpc SendToAll (MessageReq) returns (MessageResp) {}
  // SendToTargets sends a message to a channel.
  rpc SendToTargets (MessageReq) returns (MessageResp) {}
  // UserOpened is called when a user opens a connection.
  rpc UserOpened (UserOpenedReq) returns (Empty) {}
  // UserClosed is called when a user closes a connection.
  rpc UserClosed (UserClosedReq) returns (Empty) {}
  // JoinChannel adds a user to the specified channels.
  // rpc JoinChannel (ChannelReq) returns (ChannelResp) {}
  // // LeaveChannel removes a user from the specified channels.
  // rpc LeaveChannel (ChannelReq) returns (ChannelResp) {}
  // -------------------- Raft 相关方法 --------------------
  // SendRaftMessage handles a Raft message from another node
  rpc SendRaftMessage (RaftMessage) returns (Empty) {}
}