
fullnameOverride: "mimir"
runtimeConfig:
  ingester_limits: # limits that each ingester replica enforces
    max_ingestion_rate: 200000
    max_series: 1500000
    max_tenants: 1000
    max_inflight_push_requests: 300000
  distributor_limits: # limits that each distributor replica enforces
    max_ingestion_rate: 200000
    max_inflight_push_requests: 300000
    max_inflight_push_requests_bytes: 50000000
  overrides:
    defaults:
      request_rate: 10000
      request_burst_size: 200000
      ingestion_rate: 10000
      ingestion_burst_size: 200000
      max_global_series_per_user: 150000 
    cable: # limits for tenant-1 that the whole cluster enforces
      request_rate: 40000
      request_burst_size: 400000
      ingestion_rate: 40000
      ingestion_burst_size: 400000
      max_global_series_per_user: 1500000
      max_fetched_series_per_query: 100000
      
minio:
  enabled: true
  mode: standalone
  rootUser: admin
  buckets:
    - name: mimir-tsdb
      policy: none
      purge: false
    - name: mimir-ruler
      policy: none
      purge: false
  persistence:
    size: 20Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 1000m
    limits:
      memory: 2Gi
      cpu: 1000m
  rootPassword: supersecret


# 存储配置 - 使用已有的 MinIO
storage:
  backend: s3
  s3:
    endpoint: mimir-minio:9000
    bucket_name: mimir-data
    access_key_id: admin
    secret_access_key: supersecret
    insecure: true

# 数据保留策略
tenantLimits:
  global:
    ingestion_burst_size: 2000000
    ingestion_rate: 200000
    max_series_per_metric: 100000
    max_series_per_user: 10000000
    retention_period: 7d
    max_write_request_data_item_size: 31967232

# 组件配置 - 轻量级部署，单副本
alertmanager:
  enabled: false

compactor:
  replicas: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 2Gi
      cpu: 1000m

distributor:
  replicas: 3
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 2Gi
      cpu: 1000m
  config:
    remote_timeout: 5s
    ring:
      heartbeat_period: 1m
      heartbeat_timeout: 4m

ingester:
  extraArgs:
    ingester.out-of-order-time-window: 5m
  replicas: 1
  resources:
    requests:
      memory: 512Mi
      cpu: 200m
    limits:
      memory: 2Gi
      cpu: 1000m
  persistence:
    enabled: true
    storageClass: local-path
    size: 10Gi

querier:
  replicas: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 2Gi
      cpu: 1000m

queryFrontend:
  enabled: true
  replicas: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 2Gi
      cpu: 1000m

queryScheduler:
  enabled: false

ruler:
  enabled: false

storeGateway:
  replicas: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 2Gi
      cpu: 1000m
  persistence:
    enabled: true
    storageClass: local-path
    size: 5Gi

# 禁用不必要的组件
memcached:
  enabled: false

continuousTest:
  enabled: false

smokeTest:
  enabled: false

# 服务配置
service:
  type: ClusterIP
  http:
    port: 8080
  grpc:
    port: 9095
  otlp:
    http:
      port: 4318
    grpc:
      port: 4317

# 监控配置 - 与现有 Prometheus 兼容
monitoring:
  selfMonitoring:
    enabled: true
    grafanaAgent:
      installOperator: false

# 资源管理
resources:
  requests:
    memory: 256Mi
    cpu: 100m
  limits:
    memory: 2Gi
    cpu: 1000m

# 持久卷配置
persistence:
  storageClass: local-path
